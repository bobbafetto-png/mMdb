<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="mMdb.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:mMdb.ViewModels"
    xmlns:models="clr-namespace:mMdb.Models"
    x:DataType="vm:MainViewModel"
    Title="mMdb">

        <Grid RowDefinitions="Auto,*"
          ColumnDefinitions="320,*"
          Padding="16"
          RowSpacing="12"
          ColumnSpacing="12">

        <Grid Grid.Row="0"
              Grid.ColumnSpan="2"
              ColumnDefinitions="Auto,*,Auto,Auto"
              VerticalOptions="Center"
              ColumnSpacing="12">

            <Label Grid.Column="0"
                   Text="mMdb"
                   FontSize="28"
                   FontAttributes="Bold"
                   VerticalOptions="Center" />

            <Border Grid.Column="1"
                    StrokeShape="RoundRectangle 12"
                    Padding="12"
                    HorizontalOptions="Fill">
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="10">
                    <Label Text="🔎" VerticalOptions="Center" />
                    <Entry Grid.Column="1"
                           Placeholder="Skriv filmtitel…"
                           Text="{Binding Query}"
                           ClearButtonVisibility="WhileEditing" />
                </Grid>
            </Border>

            <Button Grid.Column="2"
                    Text="Hämta"
                    Padding="14,8"
                    VerticalOptions="Center"
                    Clicked="OnFetchClicked" />

            <Button Grid.Column="3"
                    x:Name="RemoveBtn"
                    Text="Ta bort"
                    Padding="14,8"
                    VerticalOptions="Center"
                    Clicked="OnRemoveClicked" />

        </Grid>

        <!-- Left: list -->
        <Border Grid.Row="1"
                Grid.Column="0"
                StrokeShape="RoundRectangle 16">
            <CollectionView ItemsSource="{Binding Films}"
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedFilm}">
                <CollectionView.ItemTemplate>
                    <!-- ÄNDRAT: Film -> LibraryListItem -->
                    <DataTemplate x:DataType="models:LibraryListItem">
                        <Grid Padding="12" RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto" RowSpacing="2">
                            <Label Grid.Row="0"
                                   Grid.Column="0"
                                   Text="{Binding Title}"
                                   FontAttributes="Bold"
                                   LineBreakMode="TailTruncation" />

                            <Label Grid.Row="1"
                                   Grid.Column="0"
                                   Text="{Binding Year}"
                                   Opacity="0.7" />

                            <!-- Format + antal -->
                            <Label Grid.Row="0"
                                   Grid.Column="1"
                                   Text="{Binding Format}"
                                   Opacity="0.85"
                                   HorizontalTextAlignment="End" />

                            <Label Grid.Row="1"
                                   Grid.Column="1"
                                   Text="{Binding Quantity}"
                                   Opacity="0.7"
                                   HorizontalTextAlignment="End" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Border>

        <!-- Right: details (null-safe) -->
        <Border Grid.Row="1"
                Grid.Column="1"
                StrokeShape="RoundRectangle 16"
                Padding="16">

            <Grid RowDefinitions="Auto,*" RowSpacing="12">

                <!-- Empty state (default hidden) -->
                <VerticalStackLayout x:Name="EmptyState" Spacing="8" IsVisible="False">
                    <Label Text="Välj en film" FontSize="22" FontAttributes="Bold" />
                    <Label Text="Detaljer visas här när du har valt en titel i listan." Opacity="0.7" />
                </VerticalStackLayout>

                <!-- Details (default visible) -->
                <Grid x:Name="Details"
                      Grid.Row="1"
                      ColumnDefinitions="220,*"
                      RowDefinitions="Auto,Auto,Auto,*"
                      ColumnSpacing="16"
                      RowSpacing="6"
                      IsVisible="True">

                    <!-- Poster -->
                    <Image Grid.RowSpan="4"
                           Grid.Column="0"
                           Source="{Binding SelectedFilm.PosterUrl}"
                           HeightRequest="320"
                           Aspect="AspectFit"
                           HorizontalOptions="Start"
                           VerticalOptions="Start" />

                    <!-- Titel -->
                    <Label Grid.Row="0"
                           Grid.Column="1"
                           Text="{Binding SelectedFilm.Title}"
                           FontSize="22"
                           FontAttributes="Bold"
                           LineBreakMode="WordWrap" />

                    <!-- År -->
                    <Label Grid.Row="1"
                           Grid.Column="1"
                           Text="{Binding SelectedFilm.Year}"
                           Opacity="0.7" />

                    <!-- Format + antal -->
                    <HorizontalStackLayout Grid.Row="2"
                                           Grid.Column="1"
                                           Spacing="12">
                        <Label Text="{Binding SelectedFilm.Format}" Opacity="0.85" />
                        <Label Text="Antal:" Opacity="0.7" />
                        <Label Text="{Binding SelectedFilm.Quantity}" Opacity="0.85" />
                    </HorizontalStackLayout>

                    <!-- Plot (obs: i list-läge finns ingen Plot, så lämna tomt eller visa placeholder) -->
                    <ScrollView Grid.Row="3"
                                Grid.Column="1">
                        <Label Text="(Detaljtext/Plot kommer från Work-nivå när du kopplar in det i listobjektet.)"
                               Opacity="0.7"
                               LineBreakMode="WordWrap" />
                    </ScrollView>

                </Grid>

                <Grid.Triggers>
                    <!-- If SelectedFilm is null: show empty state, hide details -->
                    <DataTrigger TargetType="Grid"
                                 Binding="{Binding SelectedFilm}"
                                 Value="{x:Null}">
                        <Setter TargetName="EmptyState" Property="IsVisible" Value="True" />
                        <Setter TargetName="Details" Property="IsVisible" Value="False" />
                    </DataTrigger>
                </Grid.Triggers>

            </Grid>
        </Border>

    </Grid>
</ContentPage>
